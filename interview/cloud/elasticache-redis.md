# ElastiCache Redis

ElastiCasche는 분산 In-Memory-Cache를 손쉽게 생성하고 확장할 수 있는 서비스다. 소셜 네트워크, 게임, 추천 엔진 등 읽기 중심의 서비스나 고속으로 데이터를 분석해야 하는 환경에 적합하다.

## 지원 엔진
### Memcached

![](../../.gitbook/assets/interview/cloud/screenshot%202020-02-18%20오후%205.03.52.png)

무료 오픈소스인 분산 메모리 캐시 시스템이다. 필요한 양보다 많은 메모리가 있을 때 필요한 곳에서 쉽게 가져다 쓸 수 있도록 만들어준다.

위의 그림을 보면 Memcached를 사용하지 않으면 서버에서 사용할 수 있는 것은 각각 할당된 메모리 크기 64MB뿐이며 나머지는 낭비된다. Memcached를 사용하면 논리적으로 결합되어 전체 메모리 캐시만큼 사용할 수 있다.

Memcahced로 묶인 모든 서버는 동일한 가상 메모리 풀을 공유한다. 전체 웹 클러스터에서 항상 동일한 위치에 저장되고 검색되는 것이다. 수요 증가로 서버 증설이 필요할 때 자주 사용되는 데이터에 적용할 수 있다.

분산 메모리 캐시를 적용하는 것이므로 캐싱을 통해 DB나 API 호출 횟수를 줄일 수 있어 부하를 줄이고 성능을 향상시킬 수 있다.

### Redis

오픈소스이며 NoSQL 혹은 Memcached처럼 In-Memory 솔루션으로 분류된다. String, Hash, List, Set, Sorted Set 등 다양한 데이터 형식을 제공하며 단순한 key-value 방식을 사용하므로 속도가 빠르다.

성능은 Memcached에 버금가면서 다양한 데이터 구조체를 지원해 많은 소셜 서비스에 사용되고 있다. 급격한 사용자가 집중되는 상황이나 대규모 확장이 예정되어 있는 환경이 적합하다.

## In-Memory-Cache

- 모든 데이터를 메모리(RAM)에만 올려놓고 사용하는 데이터베이스

일반적인 RDBS는 디스크(HDD, SSD)에 데이터를 영구적으로 저장해놓고 필요한 데이터만 메모리에 읽어서 사용한다.

반면 인 메모리 캐시는 디스크에 접근하지 않고 메모리로만 모두 처리하기 때문에 데이터를 저장하고 검색하는 속도가 매우 빠르다.

하지만 딱 메모리 크기만큼만 저장할 수 있고, 메모리에만 저장되어 있으므로 서버가 꺼지면 데이터는 사라진다.

보통 빠르게 처리해야 하거나 자주 사용되는 데이터를 인 메모리 캐시에 임시로 저장한다.

## ElastiCache Redis

Redis는 Memcached와 달리 노드끼리 클러스터를 구성할 수 없다. 따라서 노드를 추가한다고 해서 저장할 수 있는 전체 메모리 용량이 늘어나지 않는다.

ElastiCached Redis는 Read Replica를 지원한다. Read Replica는 master 캐시 노드에 장애가 발생하면 자동으로 slave가 master 캐시 노드로 승격된다. 이를 Failover 기능이라고 한다.

Redis 캐시 노드가 제공하는 메모리의 저장 용량을 넘어서면 애플리케이션 레벨에서 데이터를 여러 캐시 노드에 분산하는 샤딩을 구현해야 한다.

### 주의점

RDS의 DB 엔진은 AWS 외부(인터넷 등)에서 접속할 수 있지만, ElastiCache의 캐시 엔진은 외부에서 접속할 수 없다. 보안 그룹을 생성해 모든 IP를 서용해도 동일한 VPC에 속한 EC2 인스턴스만 접속할 수 있다.

따라서 접속 가능 여부를 보려면 동일 VPC 안에서 EC2 인스턴스에 접속해 telnet으로 확인해야 한다.