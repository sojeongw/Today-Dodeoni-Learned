# 스프링 DB 접근 기술

## H2 데이터베이스

MacOS는 H2 설치 뒤 권한을 주어야 제대로 실행된다.

1. H2 다운 뒤 압축을 푼 폴더로 들어간다.
2. `h2/bin` 으로 들어가면 `h2.sh` 가 있다.
3. `chmod 755 h2.sh` 를 실행한다.
4. `./h2.sh`로 h2를 실행하면 아래와 같은 경로로 접속할 수 있다.

![](../../.gitbook/assets/kimyounghan-spring-introduction/06/_2021-01-27__1.25.00.png)

상황에 따라 IP가 잡히면서 안될 떄가 있는데, 뒤는 그대로 두고(세션 키가 있어서 중요함) `localhost`로 바꿔서 접속하면 된다.

![](../../.gitbook/assets/kimyounghan-spring-introduction/06/_2021-01-27__1.27.20.png)

- JDBC URL
    - 최초에는 데이터베이스 파일을 만드는데, 그 파일 경로를 의미한다.
    - 위 그림에서는 home에 있는 test 폴더를 의미한다.
- 사용자 명과 비밀번호는 그대로 두고 연결하면 접속된다.

![](../../.gitbook/assets/kimyounghan-spring-introduction/06/_2021-01-27__1.32.15.png)

실제로 home에서 파일을 찾아보면 `test.mv.db`가 존재해야 한다. 이후부터는 파일로 접근하게 되면 웹 콘솔과 애플리케이션이 서로 충돌할 수 있다. 

![](../../.gitbook/assets/kimyounghan-spring-introduction/06/_2021-01-27__1.34.14.png)

이때는 JDBC URL에 `jdbc:h2:tcp://localhost/~/test`로 접속해야 충돌이 나지 않는다. 소켓으로 접속하는 방식이므로 여러 곳에서 접속할 수 있게 된다.

## 테이블 생성

```sql
drop table if exists member CASCADE;
     create table member
     (
         id   bigint generated by default as identity,
         name varchar(255),
         primary key (id)
);
```

- `generated by default as identity`
    - ID가 null 값일 때, DB가 자동으로 ID 값을 채워준다.
    
## 순수 JDBC

### 환경 설정

```groovy
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

`build.gradle` 파일에 jdbc, h2 데이터베이스 관련 라이브러리를 추가한다.