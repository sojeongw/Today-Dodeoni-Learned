# 다양한 연관 관계 매핑
## 연관 관계 매핑 시 고려사항 3가지
### 다중성

- @ManyToOne
- @OneToMany
- @OneToOne
- @ManyToMany

JPA 애너테이션은 DB와 매핑하기 위해 쓰는 것이기 때문에, 데이터베이스 관점에서의 다중성을 고민하면 된다. 

다중성이 애매할 때는 반대쪽을 생각하면 된다. 회원과 팀이면 반대로 팀과 회원의 관계를 생각해보면 된다. 일대일의 반대는 일대일, 일대다의 반대는 다대일, 다대다의 반대는 다대다로 대칭성이 있기 때문이다. 

참고로 사실 다대다는 실무에서 쓰지 않는다. 다대일 - 일대다 - 일대일 순으로 많이 쓴다.

### 단방향, 양방향

테이블은 외래키 하나로 양쪽 조인을 할 수 있어서 사실 방향이라는 개념이 없다. 하지만 객체는 참조용 필드가 있는 쪽으로만 참조할 수 있다. 한 쪽만 참조하면 단방향, 양쪽이 서로 참조하면 양방향이다.

하지만 사실 양방향은 단방향이 2개 존재하는 것일 뿐이다.

### 연관 관계 주인

테이블은 외래키 하나로 두 테이블이 연관 관계를 맺는다. 객체의 양방향 관계는 A->B, B->A처럼 참조가 2곳이 된다.

객체 양방향 관계는 참조가 2개이기 때문에 테이블의 외래키를 관리할 곳을 정해야 한다. 여기서 연관 관계의 주인은 외래키를 관리하는 참조다.

주인의 반대편은 외래 키에 영향을 주지 않는다. 단순 조회만 가능하다.

## 다대일

![](../../.gitbook/assets/kimyounghan-orm-jpa/06/Screen%20Shot%202021-03-20%20at%2012.17.58%20PM.png)

DB 설계 측면에서 보면 당연히 회원이 N, 팀이 1이며 외래키는 N에 가야한다. 안 그러면 설계가 잘못된 것이다. 그래야 멤버를 두 명을 넣어도 `team_id`에 같은 팀을 넣어줄 수 있는 것이다. 반대로 팀에 `member_id`를 넣는다면 팀을 여러 개 insert 해야 한다.

외래키가 있는 곳에 참조를 걸고 연관 관계 매핑을 하면 된다.

![](../../.gitbook/assets/kimyounghan-orm-jpa/06/Screen%20Shot%202021-03-20%20at%2012.18.06%20PM.png)

양방향으로 설정하는 것이 테이블에 영향을 주는 것은 아니다. 어차피 연관 관계 주인이 외래키를 관리하기 때문에 객체에서 추가만 해주면 된다.
